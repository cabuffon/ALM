<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camel="http://camel.apache.org/schema/spring"
	xsi:schemaLocation="
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
         http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">
         
    <bean id="calculoSaldoRendicion" class="cl.supereduc.iesb.CalculoSaldoRendicion"/>

	<!-- Nombre principal del contexto -->
	<camelContext xmlns="http://camel.apache.org/schema/spring" id="api-fiscalizacion-rendicion-1305-v1-orq">
	
		<!-- Bloque de control de excepcion -->
		<onException>
			    <exception>java.lang.Exception</exception>
			    <handled><simple>true</simple></handled>
			    <setHeader headerName="codeError"><constant>500</constant></setHeader>
			    <setHeader headerName="messageError"><simple>Internal Error - ${exception.message}</simple></setHeader>
			    <to uri="velocity:velocity/sqlException-json.vm"/>
		</onException>
		
		<!-- Ruta de orquestaciÃ³n del servicio -->
		<route id="orquestador">
			<from uri="direct-vm:api-fiscalizacion-rendicion-1305-v1-orq" />
			
			<to uri="direct-vm:api-fiscalizacion-rendicion-1303-v1-vm" />
			<setHeader headerName="gastosRendicion"><jsonpath>$.payload.gastosPorRendicion.Monto</jsonpath></setHeader>
			
			<to uri="direct-vm:api-fiscalizacion-rendicion-1302-v1-vm" /> 
			<setHeader headerName="ingresosRendicion"><jsonpath>$.payload.ingresoPorRendicion.Monto</jsonpath></setHeader>
			
			<to uri="direct-vm:api-fiscalizacion-rendicion-1304-v1-vm" />
			<setHeader headerName="rechazosRendicion"><jsonpath>$.payload.gastosRechazadosPorRendicion.MontoRechazado</jsonpath></setHeader>
			
			<to uri="calculoSaldoRendicion" />
			<to uri="velocity:velocity/respuesta-json.vm"/>
		</route>
		
	</camelContext>
</beans>